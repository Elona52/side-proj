<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Admin Management Page</title>
    
    <!-- Custom CSS -->
    <link rel="stylesheet" th:href="@{/css/auction.css}">
    <link rel="stylesheet" th:href="@{/css/kamco.css}">
    
    <style>
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            font-family: 'Nanum Gothic', 'Malgun Gothic', sans-serif;
            background: #f5f5f5;
        }

        body {
            padding: 20px;
        }
        
        .button-bar {
            border: 1px solid #ddd;
            padding: 15px;
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            background: #f9f9f9;
        }
        
        .button-bar button {
            padding: 8px 15px;
            cursor: pointer;
            border: 1px solid #666;
            background: white;
            font-size: 14px;
        }
        
        .button-bar button:hover {
            background: #f0f0f0;
        }
        
        .content-area {
            border: 1px solid #ddd;
            padding: 20px;
            min-height: 400px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            font-size: 13px;
            border-radius: 0;
        }
        
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
            white-space: nowrap;
            border-radius: 0;
        }
        
        th {
            background: #f0f0f0;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        pre {
            background: #f5f5f5;
            padding: 10px;
            overflow-x: auto;
            border: 1px solid #ddd;
        }
        
        .member-actions button {
            margin-right: 5px;
            padding: 4px 8px;
            font-size: 12px;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
        }
    </style>
</head>
<body>

<!-- =================== í—¤ë” =================== -->
<div th:replace="~{layout/header :: header}"></div>
    <h1>Admin Management Panel</h1>
    
    <!-- ìƒë‹¨ ë²„íŠ¼ ë°” -->
    <div class="button-bar">
        <button onclick="apiListTable()">APIëª©ë¡ì¡°íšŒ</button>
        <button onclick="apiDataRaw()">APIë°ì´í„°ì¡°íšŒ</button>
		
        <button onclick="saveToDb()">ì¡°íšŒëœë°ì´í„°DBì €ì¥</button>

        <button onclick="dbList()">ì¡°íšŒëœë°ì´í„°(DB)</button>
        <button onclick="dbDataRaw()">DBë°ì´í„°</button>
        <button onclick="dbDelete()">DBì‚­ì œ</button>
		
        <button onclick="newItemsApiList()">ì‹ ê·œë¬¼ê±´APIëª©ë¡ì¡°íšŒ</button>
        <button onclick="saveNewItemsToDb()">ì‹ ê·œë¬¼ê±´DBì €ì¥</button>
		
        <button onclick="memberList()">íšŒì›ëª©ë¡</button>
        <button onclick="boardList()">ê²Œì‹œê¸€ëª©ë¡</button>
    </div>
    
    <!-- í•˜ë‹¨ ë‚´ìš© í‘œì‹œ ì˜ì—­ -->
    <div class="content-area" id="contentArea">
        <p style="color: #999;">ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ ì—¬ê¸°ì— ë‚´ìš©ì´ í‘œì‹œë©ë‹ˆë‹¤.</p>
    </div>

    <script>
        const API_BASE = '/api/admin';
        
        // 1. API ëª©ë¡ ì¡°íšŒ (í‘œë¡œ) - ì „ì²´ ë°ì´í„°, 100ê°œì”©, í˜ì´ì§€ë„¤ì´ì…˜
        let currentApiPage = 1;
        let currentApiTotal = 0;
        
        function apiListTable(page = 1) {
            showLoading();
            currentApiPage = page;
            
            fetch(API_BASE + '/db/items-seoul?page=' + page + '&size=100')
                .then(r => r.json())
                .then(data => {
                    let html = '<h2>API ëª©ë¡ ì¡°íšŒ (í‘œ í˜•íƒœ) - ì„œìš¸íŠ¹ë³„ì‹œ</h2>';
                    html += '<p>ì´ ' + (data.totalCount || 0) + 'ê°œ (ì„œìš¸íŠ¹ë³„ì‹œë§Œ, í˜ì´ì§€ë‹¹ 100ê°œ)</p>';
                    
                    if (data.items && data.items.length > 0) {
                        html += '<div style="overflow-x: auto;">';
                        html += '<table><thead><tr>';
                        html += '<th>ID</th><th>ìˆœë²ˆ</th><th>ë¬¼ê±´ë²ˆí˜¸</th><th>ê¸°ê´€ëª…</th><th>ë¬¼ê±´ëª…</th>';
                        html += '<th>ì§€ì—­</th><th>ë„ë¡œëª…</th><th>ê±´ë¬¼ë²ˆí˜¸</th>';
                        html += '<th>ìµœì €ì…ì°°ê°€</th><th>ê°ì •í‰ê°€ì•¡</th><th>ì…ì°°ì¢…ë£Œ</th>';
                        html += '<th>ìƒíƒœ</th><th>ìœ ì°°</th><th>ì¡°íšŒìˆ˜</th>';
                        html += '</tr></thead><tbody>';
                        
                        data.items.forEach(item => {
                            html += '<tr>';
                            html += '<td>' + item.id + '</td>';
                            html += '<td>' + (item.rnum || '-') + '</td>';
                            html += '<td>' + item.cltrNo + '</td>';
                            html += '<td>' + (item.orgNm || '-') + '</td>';
                            html += '<td style="max-width:200px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">' + (item.cltrNm || '-') + '</td>';
                            html += '<td>' + (item.sido || '-') + '</td>';
                            html += '<td>' + (item.rodNm || '-') + '</td>';
                            html += '<td>' + (item.bldNo || '-') + '</td>';
                            html += '<td style="text-align:right;">' + (item.minBidPrc ? item.minBidPrc.toLocaleString() + 'ì›' : '-') + '</td>';
                            html += '<td style="text-align:right;">' + (item.apslAsesAvgAmt ? item.apslAsesAvgAmt.toLocaleString() + 'ì›' : '-') + '</td>';
                            html += '<td>' + formatDate(item.pbctClsDtm) + '</td>';
                            html += '<td>' + (item.pbctCltrStatNm || '-') + '</td>';
                            html += '<td>' + (item.uscbCnt || 0) + '</td>';
                            html += '<td>' + (item.iqryCnt || item.viewCount || 0) + '</td>';
                            html += '</tr>';
                        });
                        
                        html += '</tbody></table></div>';
                        
                        // í˜ì´ì§€ë„¤ì´ì…˜
                        const totalCount = data.totalCount || 0;
                        const pageSize = 100;
                        const totalPages = Math.ceil(totalCount / pageSize);
                        currentApiTotal = totalCount;
                        
                        html += '<div style="margin-top: 20px; text-align: center;">';
                        html += '<div style="display: inline-block;">';
                        
                        // ì´ì „ í˜ì´ì§€
                        if (page > 1) {
                            html += '<button onclick="apiListTable(' + (page - 1) + ')" style="padding: 8px 15px; margin: 0 5px;">ì´ì „</button>';
                        }
                        
                        // í˜ì´ì§€ ë²ˆí˜¸
                        const startPage = Math.max(1, page - 5);
                        const endPage = Math.min(totalPages, page + 5);
                        
                        if (startPage > 1) {
                            html += '<button onclick="apiListTable(1)" style="padding: 8px 15px; margin: 0 2px;">1</button>';
                            if (startPage > 2) html += '<span style="margin: 0 5px;">...</span>';
                        }
                        
                        for (let i = startPage; i <= endPage; i++) {
                            if (i === page) {
                                html += '<button onclick="apiListTable(' + i + ')" style="padding: 8px 15px; margin: 0 2px; background: #004098; color: white; font-weight: bold;">' + i + '</button>';
                            } else {
                                html += '<button onclick="apiListTable(' + i + ')" style="padding: 8px 15px; margin: 0 2px;">' + i + '</button>';
                            }
                        }
                        
                        if (endPage < totalPages) {
                            if (endPage < totalPages - 1) html += '<span style="margin: 0 5px;">...</span>';
                            html += '<button onclick="apiListTable(' + totalPages + ')" style="padding: 8px 15px; margin: 0 2px;">' + totalPages + '</button>';
                        }
                        
                        // ë‹¤ìŒ í˜ì´ì§€
                        if (page < totalPages) {
                            html += '<button onclick="apiListTable(' + (page + 1) + ')" style="padding: 8px 15px; margin: 0 5px;">ë‹¤ìŒ</button>';
                        }
                        
                        html += '</div>';
                        html += '<p style="margin-top: 10px; color: #666;">í˜ì´ì§€ ' + page + ' / ' + totalPages + ' (ì´ ' + totalCount + 'ê°œ)</p>';
                        html += '</div>';
                    } else {
                        html += '<p>ë°ì´í„° ì—†ìŒ</p>';
                    }
                    
                    document.getElementById('contentArea').innerHTML = html;
                });
        }
        
        // 2. API ë°ì´í„° ì¡°íšŒ (ì›ë˜ í˜•íƒœ)
        function apiDataRaw() {
            showLoading();
            
            fetch(API_BASE + '/db/items?page=1&size=10')
                .then(r => r.json())
                .then(data => {
                    let html = '<h2>API ë°ì´í„° ì¡°íšŒ (ì›ë˜ í˜•íƒœ)</h2>';
                    html += '<pre>' + JSON.stringify(data, null, 2) + '</pre>';
                    document.getElementById('contentArea').innerHTML = html;
                });
        }
        
        // 3. ì¡°íšŒëœ ë°ì´í„° DB ì €ì¥
        function saveToDb() {
            let html = '<h2>ì¡°íšŒëœ ë°ì´í„° DB ì €ì¥</h2>';
            html += '<p><strong>ë‹¨ê±´ ì €ì¥:</strong></p>';
            html += '<input type="text" id="saveInput" placeholder="ë¬¼ê±´ë²ˆí˜¸ ì…ë ¥" style="padding:8px; width:200px;"> ';
            html += '<button onclick="executeSave()" style="padding:8px 15px;">ì €ì¥</button>';
            html += '<hr style="margin:20px 0;">';
            html += '<p><strong>ì¼ê´„ ì €ì¥:</strong></p>';
            html += '<div style="display:flex; gap:10px; margin-bottom:10px;">';
            html += '<button onclick="executeSaveAllSeoul()" style="padding:10px 20px; background:#3498db; color:white; font-weight:bold; border:none; cursor:pointer; border-radius:5px;">';
            html += 'ğŸ“ ì„œìš¸íŠ¹ë³„ì‹œ ì „ì²´ ë¬¼ê±´ ì €ì¥';
            html += '</button>';
            html += '<button onclick="executeSaveNewItems()" style="padding:10px 20px; background:#27ae60; color:white; font-weight:bold; border:none; cursor:pointer; border-radius:5px;">';
            html += 'âœ¨ ì‹ ê·œ ë¬¼ê±´ ì €ì¥';
            html += '</button>';
            html += '</div>';
            html += '<p style="color:#666; font-size:12px; margin-top:5px;">';
            html += 'â€¢ ì„œìš¸íŠ¹ë³„ì‹œ ì „ì²´: ìš©ë„ë³„ ë¬¼ê±´ ì „ì²´ ì €ì¥ (ìµœëŒ€ ìˆ˜ ë¶„ ì†Œìš”)<br>';
            html += 'â€¢ ì‹ ê·œ ë¬¼ê±´: ìµœê·¼ ë“±ë¡ëœ ì‹ ê·œ ë¬¼ê±´ë§Œ ì €ì¥ (ìƒëŒ€ì ìœ¼ë¡œ ë¹ ë¦„)';
            html += '</p>';
            html += '<div id="saveResultArea" style="margin-top:20px;"></div>';
            document.getElementById('contentArea').innerHTML = html;
        }

        function executeSave() {
            const cltrNo = document.getElementById('saveInput').value;
            if (!cltrNo) {
                alert('ë¬¼ê±´ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”');
                return;
            }
            
            document.getElementById('saveResultArea').innerHTML = '<p>ì €ì¥ ì¤‘... (API í˜¸ì¶œ ë° DB ì €ì¥ ì¤‘ì…ë‹ˆë‹¤. ìµœëŒ€ 20ì´ˆ ì •ë„ ì†Œìš”ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.)</p>';
            
            const startTime = Date.now();
            fetch(API_BASE + '/save', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ cltrNo: cltrNo })
            })
                .then(r => {
                    if (!r.ok) {
                        throw new Error('ì„œë²„ ì˜¤ë¥˜: ' + r.status + ' ' + r.statusText);
                    }
                    return r.json();
                })
                .then(data => {
                    const elapsed = ((Date.now() - startTime) / 1000).toFixed(1);
                    let resultHtml = '<p style="color: green;">âœ… ì €ì¥ ì™„ë£Œ! (ì†Œìš” ì‹œê°„: ' + elapsed + 'ì´ˆ)</p>';
                    resultHtml += '<pre>' + JSON.stringify(data, null, 2) + '</pre>';
                    document.getElementById('saveResultArea').innerHTML = resultHtml;
                })
                .catch(error => {
                    const elapsed = ((Date.now() - startTime) / 1000).toFixed(1);
                    document.getElementById('saveResultArea').innerHTML = 
                        '<p style="color: red;">âŒ ì €ì¥ ì‹¤íŒ¨ (ì†Œìš” ì‹œê°„: ' + elapsed + 'ì´ˆ)</p>' +
                        '<p style="color: red;">ì˜¤ë¥˜: ' + error.message + '</p>';
                    console.error('ì €ì¥ ì˜¤ë¥˜:', error);
                });
        }
        
        // ì„œìš¸íŠ¹ë³„ì‹œ ì „ì²´ ë¬¼ê±´ ì €ì¥
        function executeSaveAllSeoul() {
            if (!confirm('ì„œìš¸íŠ¹ë³„ì‹œ ì „ì²´ ë¬¼ê±´ì„ DBì— ì €ì¥í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì´ ì‘ì—…ì€ ì‹œê°„ì´ ì˜¤ë˜ ê±¸ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤ (ìµœëŒ€ ìˆ˜ ë¶„).')) return;
            
            document.getElementById('saveResultArea').innerHTML = 
                '<p style="color:#3498db; font-weight:bold;">ğŸ“ ì„œìš¸íŠ¹ë³„ì‹œ ì „ì²´ ë¬¼ê±´ ì €ì¥ ì¤‘...</p>' +
                '<p>APIì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ DBì— ì €ì¥í•˜ê³  ìˆìŠµë‹ˆë‹¤. ìµœëŒ€ ìˆ˜ ë¶„ ì†Œìš”ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>' +
                '<p style="color:#666; font-size:12px;">ì§„í–‰ ìƒí™©ì€ ì„œë²„ ë¡œê·¸ë¥¼ í™•ì¸í•˜ì„¸ìš”.</p>';
            
            const startTime = Date.now();
            fetch(API_BASE + '/save-batch', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    sido: 'ì„œìš¸íŠ¹ë³„ì‹œ',
                    type: 'all'
                })
            })
                .then(r => {
                    if (!r.ok) {
                        throw new Error('ì„œë²„ ì˜¤ë¥˜: ' + r.status + ' ' + r.statusText);
                    }
                    return r.json();
                })
                .then(data => {
                    const elapsed = ((Date.now() - startTime) / 1000).toFixed(1);
                    const minutes = Math.floor(elapsed / 60);
                    const seconds = (elapsed % 60).toFixed(1);
                    const timeText = minutes > 0 ? minutes + 'ë¶„ ' + seconds + 'ì´ˆ' : elapsed + 'ì´ˆ';
                    
                    let resultHtml = '<p style="color: green; font-weight:bold;">âœ… ì„œìš¸íŠ¹ë³„ì‹œ ì „ì²´ ë¬¼ê±´ ì €ì¥ ì™„ë£Œ! (ì†Œìš” ì‹œê°„: ' + timeText + ')</p>';
                    resultHtml += '<p style="color: green;">ì €ì¥ëœ ê°œìˆ˜: ' + (data.savedCount || 0) + 'ê°œ / ìš”ì²­í•œ ê°œìˆ˜: ' + (data.totalRequested || 0) + 'ê°œ</p>';
                    resultHtml += '<pre style="background:#f5f5f5; padding:10px; border-radius:5px; overflow:auto;">' + JSON.stringify(data, null, 2) + '</pre>';
                    document.getElementById('saveResultArea').innerHTML = resultHtml;
                })
                .catch(error => {
                    const elapsed = ((Date.now() - startTime) / 1000).toFixed(1);
                    document.getElementById('saveResultArea').innerHTML = 
                        '<p style="color: red; font-weight:bold;">âŒ ì„œìš¸íŠ¹ë³„ì‹œ ì „ì²´ ë¬¼ê±´ ì €ì¥ ì‹¤íŒ¨ (ì†Œìš” ì‹œê°„: ' + elapsed + 'ì´ˆ)</p>' +
                        '<p style="color: red;">ì˜¤ë¥˜: ' + error.message + '</p>' +
                        '<p style="color:#666; font-size:12px;">ì„œë²„ ë¡œê·¸ë¥¼ í™•ì¸í•˜ê±°ë‚˜ ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.</p>';
                    console.error('ì„œìš¸íŠ¹ë³„ì‹œ ì „ì²´ ì €ì¥ ì˜¤ë¥˜:', error);
                });
        }
        
        // ì‹ ê·œ ë¬¼ê±´ ì €ì¥
        function executeSaveNewItems() {
            if (!confirm('ì‹ ê·œ ë¬¼ê±´ì„ DBì— ì €ì¥í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nìµœê·¼ ë“±ë¡ëœ ì‹ ê·œ ë¬¼ê±´ë§Œ ì €ì¥í•©ë‹ˆë‹¤.')) return;
            
            document.getElementById('saveResultArea').innerHTML = 
                '<p style="color:#27ae60; font-weight:bold;">âœ¨ ì‹ ê·œ ë¬¼ê±´ ì €ì¥ ì¤‘...</p>' +
                '<p>APIì—ì„œ ì‹ ê·œ ë¬¼ê±´ ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ DBì— ì €ì¥í•˜ê³  ìˆìŠµë‹ˆë‹¤.</p>' +
                '<p style="color:#666; font-size:12px;">ì§„í–‰ ìƒí™©ì€ ì„œë²„ ë¡œê·¸ë¥¼ í™•ì¸í•˜ì„¸ìš”.</p>';
            
            const startTime = Date.now();
            fetch(API_BASE + '/save-new-items-batch', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    sido: 'ì„œìš¸íŠ¹ë³„ì‹œ'
                })
            })
                .then(r => {
                    if (!r.ok) {
                        throw new Error('ì„œë²„ ì˜¤ë¥˜: ' + r.status + ' ' + r.statusText);
                    }
                    return r.json();
                })
                .then(data => {
                    const elapsed = ((Date.now() - startTime) / 1000).toFixed(1);
                    const minutes = Math.floor(elapsed / 60);
                    const seconds = (elapsed % 60).toFixed(1);
                    const timeText = minutes > 0 ? minutes + 'ë¶„ ' + seconds + 'ì´ˆ' : elapsed + 'ì´ˆ';
                    
                    let resultHtml = '<p style="color: green; font-weight:bold;">âœ… ì‹ ê·œ ë¬¼ê±´ ì €ì¥ ì™„ë£Œ! (ì†Œìš” ì‹œê°„: ' + timeText + ')</p>';
                    resultHtml += '<p style="color: green;">ì €ì¥ëœ ê°œìˆ˜: ' + (data.savedCount || 0) + 'ê°œ</p>';
                    resultHtml += '<pre style="background:#f5f5f5; padding:10px; border-radius:5px; overflow:auto;">' + JSON.stringify(data, null, 2) + '</pre>';
                    document.getElementById('saveResultArea').innerHTML = resultHtml;
                })
                .catch(error => {
                    const elapsed = ((Date.now() - startTime) / 1000).toFixed(1);
                    document.getElementById('saveResultArea').innerHTML = 
                        '<p style="color: red; font-weight:bold;">âŒ ì‹ ê·œ ë¬¼ê±´ ì €ì¥ ì‹¤íŒ¨ (ì†Œìš” ì‹œê°„: ' + elapsed + 'ì´ˆ)</p>' +
                        '<p style="color: red;">ì˜¤ë¥˜: ' + error.message + '</p>' +
                        '<p style="color:#666; font-size:12px;">ì„œë²„ ë¡œê·¸ë¥¼ í™•ì¸í•˜ê±°ë‚˜ ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.</p>';
                    console.error('ì‹ ê·œ ë¬¼ê±´ ì €ì¥ ì˜¤ë¥˜:', error);
                });
        }
        
        // 4. ì¡°íšŒëœ ë°ì´í„° (DBì—ì„œ) - ì„œìš¸íŠ¹ë³„ì‹œë§Œ, 50ê°œ
        function dbList() {
            showLoading();
            
            fetch(API_BASE + '/db/items-seoul?page=1&size=50')
                .then(r => r.json())
                .then(data => {
                    let html = '<h2>DB ì €ì¥ ë°ì´í„° ì¡°íšŒ (í‘œ í˜•íƒœ) - ì„œìš¸íŠ¹ë³„ì‹œ</h2>';
                    html += '<p>ì´ ' + (data.totalCount || 0) + 'ê°œ (ì„œìš¸íŠ¹ë³„ì‹œ í‘œì‹œ)</p>';
                    
                    if (data.items && data.items.length > 0) {
                        html += '<div style="overflow-x: auto;">';
                        html += '<table><thead><tr>';
                        html += '<th>ID</th><th>ìˆœë²ˆ</th><th>ë¬¼ê±´ë²ˆí˜¸</th><th>ê¸°ê´€ëª…</th><th>ë¬¼ê±´ëª…</th>';
                        html += '<th>ì§€ì—­</th><th>ë„ë¡œëª…</th><th>ê±´ë¬¼ë²ˆí˜¸</th>';
                        html += '<th>ìµœì €ì…ì°°ê°€</th><th>ê°ì •í‰ê°€ì•¡</th><th>ì…ì°°ì¢…ë£Œ</th>';
                        html += '<th>ìƒíƒœ</th><th>ìœ ì°°</th><th>ì¡°íšŒìˆ˜</th>';
                        html += '</tr></thead><tbody>';
                        
                        data.items.forEach(item => {
                            html += '<tr>';
                            html += '<td>' + item.id + '</td>';
                            html += '<td>' + (item.rnum || '-') + '</td>';
                            html += '<td>' + item.cltrNo + '</td>';
                            html += '<td>' + (item.orgNm || '-') + '</td>';
                            html += '<td style="max-width:200px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">' + (item.cltrNm || '-') + '</td>';
                            html += '<td>' + (item.sido || '-') + '</td>';
                            html += '<td>' + (item.rodNm || '-') + '</td>';
                            html += '<td>' + (item.bldNo || '-') + '</td>';
                            html += '<td style="text-align:right;">' + (item.minBidPrc ? item.minBidPrc.toLocaleString() + 'ì›' : '-') + '</td>';
                            html += '<td style="text-align:right;">' + (item.apslAsesAvgAmt ? item.apslAsesAvgAmt.toLocaleString() + 'ì›' : '-') + '</td>';
                            html += '<td>' + formatDate(item.pbctClsDtm) + '</td>';
                            html += '<td>' + (item.pbctCltrStatNm || '-') + '</td>';
                            html += '<td>' + (item.uscbCnt || 0) + '</td>';
                            html += '<td>' + (item.iqryCnt || item.viewCount || 0) + '</td>';
                            html += '</tr>';
                        });
                        
                        html += '</tbody></table></div>';
                    } else {
                        html += '<p>ë°ì´í„° ì—†ìŒ</p>';
                    }
                    
                    document.getElementById('contentArea').innerHTML = html;
                });
        }
        
        // ì‹ ê·œ ë¬¼ê±´ API ëª©ë¡ ì¡°íšŒ (í‘œë¡œ) - í˜ì´ì§€ë„¤ì´ì…˜
        let currentNewItemsPage = 1;
        
        function newItemsApiList(page = 1) {
            showLoading();
            currentNewItemsPage = page;
            
            fetch(API_BASE + '/api/new-items?page=' + page + '&size=100&sido=ì„œìš¸íŠ¹ë³„ì‹œ')
                .then(r => r.json())
                .then(data => {
                    let html = '<h2>ì‹ ê·œ ë¬¼ê±´ API ëª©ë¡ ì¡°íšŒ</h2>';
                    html += '<p>ì´ ' + (data.totalCount || 0) + 'ê°œ (í˜ì´ì§€ë‹¹ 100ê°œ)</p>';
                    
                    if (data.items && data.items.length > 0) {
                        html += '<div style="overflow-x: auto;">';
                        html += '<table><thead><tr>';
                        html += '<th>ìˆœë²ˆ</th><th>ë¬¼ê±´ë²ˆí˜¸</th><th>ê¸°ê´€ëª…</th><th>ë¬¼ê±´ëª…</th>';
                        html += '<th>ì§€ì—­</th><th>ë„ë¡œëª…</th><th>ê±´ë¬¼ë²ˆí˜¸</th>';
                        html += '<th>ìµœì €ì…ì°°ê°€</th><th>ê°ì •í‰ê°€ì•¡</th><th>ì…ì°°ì¢…ë£Œ</th>';
                        html += '<th>ìƒíƒœ</th><th>ìœ ì°°</th><th>ì¡°íšŒìˆ˜</th>';
                        html += '</tr></thead><tbody>';
                        
                        data.items.forEach((item, index) => {
                            html += '<tr>';
                            html += '<td>' + ((page - 1) * 100 + index + 1) + '</td>';
                            html += '<td>' + (item.cltrNo || '-') + '</td>';
                            html += '<td>' + (item.orgNm || '-') + '</td>';
                            html += '<td style="max-width:200px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">' + (item.cltrNm || '-') + '</td>';
                            html += '<td>' + (item.sido || '-') + '</td>';
                            html += '<td>' + (item.rodNm || '-') + '</td>';
                            html += '<td>' + (item.bldNo || '-') + '</td>';
                            html += '<td style="text-align:right;">' + (item.minBidPrc ? item.minBidPrc.toLocaleString() + 'ì›' : '-') + '</td>';
                            html += '<td style="text-align:right;">' + (item.apslAsesAvgAmt ? item.apslAsesAvgAmt.toLocaleString() + 'ì›' : '-') + '</td>';
                            html += '<td>' + formatDate(item.pbctClsDtm) + '</td>';
                            html += '<td>' + (item.pbctCltrStatNm || '-') + '</td>';
                            html += '<td>' + (item.uscbCnt || 0) + '</td>';
                            html += '<td>' + (item.iqryCnt || 0) + '</td>';
                            html += '</tr>';
                        });
                        
                        html += '</tbody></table></div>';
                        
                        // í˜ì´ì§€ë„¤ì´ì…˜
                        const totalCount = data.totalCount || 0;
                        const pageSize = 100;
                        const totalPages = Math.ceil(totalCount / pageSize);
                        
                        html += '<div style="margin-top: 20px; text-align: center;">';
                        html += '<div style="display: inline-block;">';
                        
                        // ì´ì „ í˜ì´ì§€
                        if (page > 1) {
                            html += '<button onclick="newItemsApiList(' + (page - 1) + ')" style="padding: 8px 15px; margin: 0 5px;">ì´ì „</button>';
                        }
                        
                        // í˜ì´ì§€ ë²ˆí˜¸
                        const startPage = Math.max(1, page - 5);
                        const endPage = Math.min(totalPages, page + 5);
                        
                        if (startPage > 1) {
                            html += '<button onclick="newItemsApiList(1)" style="padding: 8px 15px; margin: 0 2px;">1</button>';
                            if (startPage > 2) html += '<span style="margin: 0 5px;">...</span>';
                        }
                        
                        for (let i = startPage; i <= endPage; i++) {
                            if (i === page) {
                                html += '<button onclick="newItemsApiList(' + i + ')" style="padding: 8px 15px; margin: 0 2px; background: #004098; color: white; font-weight: bold;">' + i + '</button>';
                            } else {
                                html += '<button onclick="newItemsApiList(' + i + ')" style="padding: 8px 15px; margin: 0 2px;">' + i + '</button>';
                            }
                        }
                        
                        if (endPage < totalPages) {
                            if (endPage < totalPages - 1) html += '<span style="margin: 0 5px;">...</span>';
                            html += '<button onclick="newItemsApiList(' + totalPages + ')" style="padding: 8px 15px; margin: 0 2px;">' + totalPages + '</button>';
                        }
                        
                        // ë‹¤ìŒ í˜ì´ì§€
                        if (page < totalPages) {
                            html += '<button onclick="newItemsApiList(' + (page + 1) + ')" style="padding: 8px 15px; margin: 0 5px;">ë‹¤ìŒ</button>';
                        }
                        
                        html += '</div>';
                        html += '<p style="margin-top: 10px; color: #666;">í˜ì´ì§€ ' + page + ' / ' + totalPages + ' (ì´ ' + totalCount + 'ê°œ)</p>';
                        html += '</div>';
                    } else {
                        html += '<p>ë°ì´í„° ì—†ìŒ</p>';
                    }
                    
                    document.getElementById('contentArea').innerHTML = html;
                })
                .catch(error => {
                    document.getElementById('contentArea').innerHTML = 
                        '<h2>ì‹ ê·œ ë¬¼ê±´ API ëª©ë¡ ì¡°íšŒ</h2><p style="color: red;">ì˜¤ë¥˜: ' + error.message + '</p>';
                });
        }
        
        // ì‹ ê·œ ë¬¼ê±´ DB ì €ì¥
        function saveNewItemsToDb() {
            let html = '<h2>ì‹ ê·œ ë¬¼ê±´ DB ì €ì¥</h2>';
            html += '<p><strong>ì „ì²´ ì €ì¥:</strong></p>';
            html += '<button onclick="executeSaveNewItemsBatch()" style="padding:8px 15px; background:#e74c3c; color:white; font-weight:bold;">ì‹ ê·œ ë¬¼ê±´ ì „ì²´ ì €ì¥</button>';
            html += '<p style="color: #666; margin-top: 10px;">â€» ì‹ ê·œ ë¬¼ê±´ ì „ì²´ ì €ì¥ì€ ì—¬ëŸ¬ í˜ì´ì§€ì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ DBì— ì €ì¥í•©ë‹ˆë‹¤.</p>';
            html += '<div id="saveNewItemsResultArea" style="margin-top:20px;"></div>';
            document.getElementById('contentArea').innerHTML = html;
        }
        
        function executeSaveNewItemsBatch() {
            if (!confirm('ì‹ ê·œ ë¬¼ê±´ ì „ì²´ë¥¼ DBì— ì €ì¥í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì—¬ëŸ¬ í˜ì´ì§€ì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ ì €ì¥í•©ë‹ˆë‹¤.')) return;
            
            document.getElementById('saveNewItemsResultArea').innerHTML = '<p>ì‹ ê·œ ë¬¼ê±´ ì „ì²´ ì €ì¥ ì¤‘... (ì‹œê°„ì´ ê±¸ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤)</p>';
            
            fetch(API_BASE + '/save-new-items-batch', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    sido: 'ì„œìš¸íŠ¹ë³„ì‹œ'
                })
            })
                .then(r => r.json())
                .then(data => {
                    document.getElementById('saveNewItemsResultArea').innerHTML = 
                        '<pre>' + JSON.stringify(data, null, 2) + '</pre>';
                })
                .catch(error => {
                    document.getElementById('saveNewItemsResultArea').innerHTML = 
                        '<p style="color: red;">ì˜¤ë¥˜: ' + error.message + '</p>';
                });
        }
        
        // 5. DB ë°ì´í„° (ì›ë˜ í˜•íƒœ)
        function dbDataRaw() {
            showLoading();
            
            fetch(API_BASE + '/db/items-seoul?page=1&size=10')
                .then(r => r.json())
                .then(data => {
                    let html = '<h2>DB ë°ì´í„° (ì›ë˜ í˜•íƒœ, ì„œìš¸íŠ¹ë³„ì‹œë§Œ)</h2>';
                    html += '<pre>' + JSON.stringify(data, null, 2) + '</pre>';
                    document.getElementById('contentArea').innerHTML = html;
                });
        }
        
        // 6. DB ì‚­ì œ
        function dbDelete() {
            let html = '<h2>DB ë°ì´í„° ì‚­ì œ</h2>';
            html += '<p><strong>ë‹¨ê±´ ì‚­ì œ (IDë¡œ):</strong></p>';
            html += '<input type="number" id="deleteIdInput" placeholder="ID ì…ë ¥" style="padding:8px; width:200px;"> ';
            html += '<button onclick="executeDeleteById()" style="padding:8px 15px;">ì‚­ì œ</button>';
            html += '<hr style="margin:20px 0;">';
            html += '<p><strong>ë‹¨ê±´ ì‚­ì œ (ë¬¼ê±´ë²ˆí˜¸ë¡œ):</strong></p>';
            html += '<input type="text" id="deleteCltrNoInput" placeholder="ë¬¼ê±´ë²ˆí˜¸ ì…ë ¥" style="padding:8px; width:200px;"> ';
            html += '<button onclick="executeDeleteByCltrNo()" style="padding:8px 15px;">ì‚­ì œ</button>';
            html += '<hr style="margin:20px 0;">';
            html += '<p><strong>ëŒ€ëŸ‰ ì‚­ì œ:</strong></p>';
            html += '<button onclick="executeDeleteNonSeoul()" style="padding:8px 15px; margin-right:10px; background:#e67e22; color:white;">ì„œìš¸ ì™¸ ì§€ì—­ ì‚­ì œ</button>';
            html += '<button onclick="executeDeleteAll()" style="padding:8px 15px; background:#c0392b; color:white; font-weight:bold;">âš ï¸ ì „ì²´ ì‚­ì œ</button>';
            html += '<div id="deleteResultArea" style="margin-top:20px;"></div>';
            document.getElementById('contentArea').innerHTML = html;
        }
        
        function executeDeleteById() {
            const id = document.getElementById('deleteIdInput').value;
            if (!id) {
                alert('IDë¥¼ ì…ë ¥í•˜ì„¸ìš”');
                return;
            }
            
            if (!confirm('ID ' + id + 'ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            document.getElementById('deleteResultArea').innerHTML = '<p>ì‚­ì œ ì¤‘...</p>';
            
            fetch(API_BASE + '/db/item/' + id, { method: 'DELETE' })
                .then(r => r.json())
                .then(data => {
                    document.getElementById('deleteResultArea').innerHTML = 
                        '<pre>' + JSON.stringify(data, null, 2) + '</pre>';
                });
        }
        
        function executeDeleteByCltrNo() {
            const cltrNo = document.getElementById('deleteCltrNoInput').value;
            if (!cltrNo) {
                alert('ë¬¼ê±´ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”');
                return;
            }
            
            if (!confirm('ë¬¼ê±´ë²ˆí˜¸ ' + cltrNo + 'ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            document.getElementById('deleteResultArea').innerHTML = '<p>ì‚­ì œ ì¤‘...</p>';
            
            fetch(API_BASE + '/db/item-by-cltr/' + cltrNo, { method: 'DELETE' })
                .then(r => r.json())
                .then(data => {
                    document.getElementById('deleteResultArea').innerHTML = 
                        '<pre>' + JSON.stringify(data, null, 2) + '</pre>';
                });
        }
        
        function executeDeleteNonSeoul() {
            if (!confirm('ì„œìš¸íŠ¹ë³„ì‹œê°€ ì•„ë‹Œ ëª¨ë“  ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            document.getElementById('deleteResultArea').innerHTML = '<p>ì„œìš¸ ì™¸ ì§€ì—­ ì‚­ì œ ì¤‘...</p>';
            
            fetch(API_BASE + '/db/delete-non-seoul', { method: 'DELETE' })
                .then(r => r.json())
                .then(data => {
                    document.getElementById('deleteResultArea').innerHTML = 
                        '<pre>' + JSON.stringify(data, null, 2) + '</pre>';
                });
        }
        
        function executeDeleteAll() {
            if (!confirm('âš ï¸âš ï¸âš ï¸ ê²½ê³  âš ï¸âš ï¸âš ï¸\n\nëª¨ë“  ë¬¼ê±´ ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!')) return;
            if (!confirm('ì •ë§ë¡œ ì „ì²´ ì‚­ì œë¥¼ ì§„í–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ? (ìµœì¢… í™•ì¸)')) return;
            
            const confirmText = prompt('ì „ì²´ ì‚­ì œë¥¼ ì§„í–‰í•˜ë ¤ë©´ "ì „ì²´ì‚­ì œ" ë¥¼ ì…ë ¥í•˜ì„¸ìš”:');
            if (confirmText !== 'ì „ì²´ì‚­ì œ') {
                alert('ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.');
                return;
            }
            
            document.getElementById('deleteResultArea').innerHTML = '<p style="color:red; font-weight:bold;">ì „ì²´ ë°ì´í„° ì‚­ì œ ì¤‘...</p>';
            
            fetch(API_BASE + '/db/delete-all', { method: 'DELETE' })
                .then(r => r.json())
                .then(data => {
                    document.getElementById('deleteResultArea').innerHTML = 
                        '<pre>' + JSON.stringify(data, null, 2) + '</pre>';
                });
        }
        
        // 7. íšŒì› ëª©ë¡
        function memberList() {
            showLoading();
            
            fetch(API_BASE + '/members/all')
                .then(r => r.json())
                .then(data => {
                    let html = '<h2>íšŒì› ëª©ë¡</h2>';
                    html += '<p>ì´ ' + (data.length || 0) + 'ëª…</p>';
                    
                    if (data && data.length > 0) {
                        html += '<table><thead><tr>';
                        html += '<th>ID</th><th>ì´ë¦„</th><th>ì´ë©”ì¼</th><th>ê°€ì…ì¼</th><th>ê´€ë¦¬</th>';
                        html += '</tr></thead><tbody>';
                        
                        data.forEach(member => {
                            html += '<tr>';
                            html += '<td>' + member.id + '</td>';
                            html += '<td>' + member.name + '</td>';
                            html += '<td>' + member.mail + '</td>';
                            html += '<td>' + formatDate2(member.joinDate) + '</td>';
                            html += '<td class="member-actions">';
                            html += '<button onclick="editMember(\'' + member.id + '\')">ìˆ˜ì •</button>';
                            html += '<button onclick="deleteMember(\'' + member.id + '\')">ì‚­ì œ</button>';
                            html += '</td>';
                            html += '</tr>';
                        });
                        
                        html += '</tbody></table>';
                    } else {
                        html += '<p>íšŒì›ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                    }
                    
                    document.getElementById('contentArea').innerHTML = html;
                })
                .catch(error => {
                    document.getElementById('contentArea').innerHTML = 
                        '<h2>íšŒì› ëª©ë¡</h2><p>ì˜¤ë¥˜: ' + error.message + '</p>' +
                        '<p>íšŒì› API ì—”ë“œí¬ì¸íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤. memberList() ë©”ì„œë“œ ì¶”ê°€ í•„ìš”.</p>';
                });
        }
        
        function deleteMember(memberId) {
            if (!confirm('íšŒì› ' + memberId + 'ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            fetch(API_BASE + '/members/' + memberId, {
                method: 'DELETE'
            })
            .then(r => r.json())
            .then(data => {
                alert(data.message || 'ì‚­ì œ ì™„ë£Œ');
                memberList();
            })
            .catch(err => {
                alert('ì‚­ì œ ì¤‘ ì˜¤ë¥˜: ' + err.message);
            });
        }

        function editMember(memberId) {
            const newName = prompt('ìƒˆ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš” (ë¹„ì›Œë‘ë©´ ë³€ê²½ ì•ˆ í•¨):');
            const newEmail = prompt('ìƒˆ ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš” (ë¹„ì›Œë‘ë©´ ë³€ê²½ ì•ˆ í•¨):');
            const newPhone = prompt('ìƒˆ ì „í™”ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ë¹„ì›Œë‘ë©´ ë³€ê²½ ì•ˆ í•¨):');

            const payload = { memberId: memberId };
            if (newName && newName.trim() !== '') payload.name = newName.trim();
            if (newEmail && newEmail.trim() !== '') payload.mail = newEmail.trim();
            if (newPhone && newPhone.trim() !== '') payload.phone = newPhone.trim();

            if (Object.keys(payload).length === 1) {
                alert('ë³€ê²½í•  ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            fetch(API_BASE + '/members/update', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            })
            .then(r => r.json())
            .then(data => {
                alert(data.message || 'ìˆ˜ì • ì™„ë£Œ');
                memberList();
            })
            .catch(err => {
                alert('ìˆ˜ì • ì¤‘ ì˜¤ë¥˜: ' + err.message);
            });
        }
        
        // 8. ê²Œì‹œê¸€ ëª©ë¡
        function boardList() {
            showLoading();
            
            fetch(API_BASE + '/boards/all')
                .then(r => r.json())
                .then(data => {
                    let html = '<h2>ê²Œì‹œê¸€ ëª©ë¡</h2>';
                    html += '<p>ì´ ' + (data.length || 0) + 'ê°œ</p>';
                    
                    if (data && data.length > 0) {
                        html += '<table><thead><tr>';
                        html += '<th>ë²ˆí˜¸</th><th>ì œëª©</th><th>ì‘ì„±ì</th><th>ì‘ì„±ì¼</th><th>ê´€ë¦¬</th>';
                        html += '</tr></thead><tbody>';
                        
                        data.forEach(board => {
                            html += '<tr>';
                            html += '<td>' + board.no + '</td>';
                            html += '<td>' + board.title + '</td>';
                            html += '<td>' + board.id + '</td>';
                            html += '<td>' + formatDate2(board.regDate) + '</td>';
                            html += '<td>';
                            html += '<button onclick="deleteBoard(' + board.no + ')">ì‚­ì œ</button>';
                            html += '</td>';
                            html += '</tr>';
                        });
                        
                        html += '</tbody></table>';
                    } else {
                        html += '<p>ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                    }
                    
                    document.getElementById('contentArea').innerHTML = html;
                })
                .catch(error => {
                    document.getElementById('contentArea').innerHTML = 
                        '<h2>ê²Œì‹œê¸€ ëª©ë¡</h2><p>ì˜¤ë¥˜: ' + error.message + '</p>' +
                        '<p>ê²Œì‹œíŒ API ì—”ë“œí¬ì¸íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤. boardList() ë©”ì„œë“œ ì¶”ê°€ í•„ìš”.</p>';
                });
        }

        function deleteBoard(boardNo) {
            if (!confirm('ê²Œì‹œê¸€ ë²ˆí˜¸ ' + boardNo + 'ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;

            fetch(API_BASE + '/boards/' + boardNo, {
                method: 'DELETE'
            })
            .then(r => r.json())
            .then(data => {
                alert(data.message || 'ì‚­ì œ ì™„ë£Œ');
                boardList();
            })
            .catch(err => {
                alert('ì‚­ì œ ì¤‘ ì˜¤ë¥˜: ' + err.message);
            });
        }
        
        // ìœ í‹¸ë¦¬í‹°
        function showLoading() {
            document.getElementById('contentArea').innerHTML = 
                '<div class="loading">ë¡œë”© ì¤‘...</div>';
        }
        
        function formatDate(dateStr) {
            if (!dateStr) return '-';
            try {
                const year = dateStr.substring(0, 4);
                const month = dateStr.substring(4, 6);
                const day = dateStr.substring(6, 8);
                const hour = dateStr.substring(8, 10);
                const minute = dateStr.substring(10, 12);
                return year + '-' + month + '-' + day + ' ' + hour + ':' + minute;
            } catch (e) {
                return dateStr;
            }
        }
        
        function formatDate2(dateStr) {
            if (!dateStr) return '-';
            return new Date(dateStr).toLocaleString('ko-KR');
        }
    </script>

<!-- =================== í‘¸í„° =================== -->
<div th:replace="~{layout/footer :: footer}"></div>

</body>
</html>
