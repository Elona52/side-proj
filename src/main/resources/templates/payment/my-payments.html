<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì…ì°°ë‚´ì—­ê´€ë¦¬ - ë‚˜ì˜ê²½ë§¤</title>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic:wght@400;700;800&display=swap" rel="stylesheet">
    
    <!-- Court Auction CSS -->
    <link rel="stylesheet" th:href="@{/css/auction.css}">
    <link rel="stylesheet" th:href="@{/css/kamco.css}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" th:href="@{/css/style.css}">
    
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    
    <style>
        :root {
            --court-blue: #004098;
            --court-navy: #002855;
            --border-gray: #ddd;
            --bg-light: #f5f5f5;
            --text-dark: #333;
            --text-gray: #777;
        }

        /* ========== ë©”ì¸ ë ˆì´ì•„ì›ƒ ========== */
        .board-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 40px 20px;
            display: flex;
            gap: 30px;
        }

        .side-menu {
            width: 250px;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            padding: 0;
            height: fit-content;
            position: sticky;
            top: 20px;
        }

        .side-menu-header {
            background: var(--court-blue);
            color: #fff;
            padding: 15px 20px;
            font-size: 16px;
            font-weight: 700;
        }

        .side-menu-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .side-menu-item {
            border-bottom: 1px solid #f0f0f0;
        }

        .side-menu-item a {
            display: block;
            padding: 14px 20px;
            color: var(--text-dark);
            text-decoration: none;
            font-size: 14px;
            transition: all 0.3s;
        }

        .side-menu-item a:hover {
            background: #f8f9fa;
            color: var(--court-blue);
            padding-left: 25px;
        }

        .side-menu-item.active a {
            background: var(--court-blue);
            color: #fff;
            font-weight: 700;
        }

        .main-content {
            flex: 1;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            min-width: 0;
        }

        .breadcrumb {
            padding: 15px 25px;
            border-bottom: 1px solid var(--border-gray);
            font-size: 13px;
            color: var(--text-gray);
        }

        .breadcrumb a {
            color: var(--text-gray);
            text-decoration: none;
        }

        .breadcrumb a:hover {
            color: var(--court-blue);
        }

        .search-summary {
            padding: 20px 25px;
            background: #f8f9fa;
            border-bottom: 1px solid var(--border-gray);
        }

        .search-summary-title {
            font-size: 15px;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 10px;
        }

        .search-summary-text {
            font-size: 14px;
            color: var(--text-gray);
        }

        .search-summary-text strong {
            color: var(--court-blue);
            font-weight: 700;
        }

        .note {
            padding: 12px 25px;
            background: #fffbf0;
            border-bottom: 1px solid #ffe082;
            font-size: 13px;
            color: #795548;
        }

        /* ========== ì…ì°°ë‚´ì—­ í…Œì´ë¸” ========== */
        .table-container {
            padding: 25px !important;
            width: 100% !important;
            max-width: 100% !important;
            overflow-x: auto !important;
        }

        .auction-table {
            width: 100% !important;
            max-width: none !important;
            min-width: 100% !important;
            border-collapse: collapse !important;
            font-size: 13px !important;
            table-layout: fixed !important;
        }

        .auction-table th,
        .auction-table td {
            border-radius: 0 !important;
            overflow: hidden !important;
            text-overflow: ellipsis !important;
        }

        .auction-table thead {
            background: #f8f9fa;
            border-top: 2px solid var(--court-blue);
            border-bottom: 1px solid var(--border-gray);
        }

        .auction-table th {
            padding: 12px 10px;
            text-align: center;
            font-weight: 700;
            color: var(--text-dark);
            font-size: 14px;
        }

        .auction-table tbody tr {
            height: auto;
            min-height: 60px;
        }

        .auction-table tbody td {
            padding: 12px 10px;
            border-bottom: 1px solid #f0f0f0;
            vertical-align: middle;
        }

        .auction-table tbody tr:hover {
            background: #f8f9fa;
        }

        .item-number {
            text-align: center;
            color: var(--text-gray);
            font-weight: 600;
        }

        .location-details {
            text-align: left;
        }

        .usage-badge {
            display: inline-block;
            padding: 2px 8px;
            background: var(--court-blue);
            color: #fff;
            border-radius: 3px;
            font-size: 11px;
            font-weight: 700;
            margin-right: 5px;
        }

        .case-number {
            font-size: 11px;
            color: var(--text-gray);
        }

        .address {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-dark);
            margin: 5px 0;
        }

        .building-info {
            font-size: 12px;
            color: var(--text-gray);
            margin-top: 3px;
        }

        .remarks {
            text-align: left;
            font-size: 12px;
            color: var(--text-gray);
        }

        .price-info {
            text-align: right;
        }

        .price-label {
            font-size: 11px;
            color: var(--text-gray);
            margin-bottom: 3px;
        }

        .price-value {
            font-size: 14px;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 8px;
        }

        .price-value.min-price {
            color: var(--court-blue);
        }

        .price-percent {
            font-size: 12px;
            color: var(--text-gray);
            margin-left: 5px;
            font-weight: 500;
        }

        .dept-info {
            text-align: center;
        }

        .dept-name {
            font-size: 13px;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 8px;
        }

        .auction-date {
            font-size: 13px;
            color: var(--court-blue);
            font-weight: 700;
            margin-bottom: 8px;
        }

        .status-badge-table {
            display: inline-block;
            padding: 4px 10px;
            background: #fff3cd;
            color: #856404;
            border-radius: 0;
            font-size: 12px;
            font-weight: 600;
        }

        .status-badge-table.new {
            background: #d4edda;
            color: #155724;
        }

        .status-badge-table.failed {
            background: #f8d7da;
            color: #721c24;
        }

        .status-badge-table.paid {
            background: #d4edda;
            color: #155724;
        }

        .status-badge-table.unpaid {
            background: #f8d7da;
            color: #721c24;
        }

        .bid-submit-date {
            font-size: 12px;
            color: var(--text-gray);
            margin-bottom: 5px;
        }

        .bid-deadline {
            font-size: 12px;
            color: var(--court-blue);
            font-weight: 600;
        }

        .payment-action {
            text-align: center;
        }

        .btn-payment {
            padding: 8px 16px;
            background: rgb(21, 165, 87);
            color: #fff;
            border: none;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-payment:hover {
            background: #c82333;
        }

        .btn-payment:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .btn-delete {
            background: #dc3545;
            color: #fff;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-delete:hover {
            background: #c82333;
        }

        .btn-delete:active {
            background: #bd2130;
        }

        .no-payments {
            text-align: center;
            padding: 80px 20px;
            background: #fff;
        }

        .no-payments-icon {
            font-size: 72px;
            margin-bottom: 20px;
            color: #ddd;
        }

        .no-payments h3 {
            color: #666;
            margin-bottom: 10px;
        }

        .no-payments p {
            color: #999;
            margin-bottom: 30px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: var(--text-gray);
        }

        @media (max-width: 768px) {
            .board-container {
                flex-direction: column;
            }
            .side-menu {
                width: 100% !important;
                max-width: 100% !important;
            }
        }
    </style>
</head>
<body>

<!-- =================== í—¤ë” =================== -->
<div th:replace="~{layout/header :: header}"></div>

<!-- ë©”ì¸ ì»¨í…ì¸  -->
<main class="board-container">
    <!-- ì¢Œì¸¡ ë„¤ë¹„ -->
    <aside class="side-menu">
        <div class="side-menu-header">â€¢ ë‚˜ì˜ê²½ë§¤</div>
        <ul class="side-menu-list">
            <li class="side-menu-item">
                <a th:href="@{/myFavorites}">
                    <i class="fas fa-star"></i> ì¦ê²¨ì°¾ê¸°
                </a>
            </li>
            <li class="side-menu-item active">
                <a th:href="@{/payment/my-payments}">
                    <i class="fas fa-gavel"></i> ì…ì°°ë‚´ì—­ê´€ë¦¬
                </a>
            </li>
            <li class="side-menu-item">
                <a th:href="@{/price-alerts}">
                    <i class="fas fa-bell"></i> ê°€ê²© ì•Œë¦¼
                </a>
            </li>
        </ul>
    </aside>

    <!-- ì˜¤ë¥¸ìª½ ë©”ì¸ -->
    <section class="main-content">
        <!-- ë¸Œë ˆë“œí¬ëŸ¼ -->
        <div class="breadcrumb">
            <a th:href="@{/main}">â–² HOME</a> &gt;
            <a th:href="@{/payment/my-payments}">ë‚˜ì˜ê²½ë§¤</a> &gt;
            <span>ì…ì°°ë‚´ì—­ê´€ë¦¬</span>
        </div>

        <!-- ê²€ìƒ‰ ìš”ì•½ -->
        <div class="search-summary">
            <div class="search-summary-title">ì…ì°°ë‚´ì—­ê´€ë¦¬</div>
            <div class="search-summary-text">
                ì´ ì…ì°°ë‚´ì—­ <strong id="paymentsCount" th:text="${payments != null ? payments.size() : 0} + 'ê±´'">0ê±´</strong>
            </div>
        </div>

        <!-- ì•ˆë‚´ ë¬¸êµ¬ -->
        <div class="note">
            â€¢ ì†Œì¬ì§€ ë° ë‚´ì—­ì„ í´ë¦­í•˜ë©´ ë¬¼ê±´ìƒì„¸ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.
        </div>

        <!-- ì…ì°°ë‚´ì—­ ëª©ë¡ (í…Œì´ë¸”) -->
        <div class="table-container">
            <div id="paymentsContainer">
                <div class="loading" th:if="${payments == null}">
                    <i class="fas fa-spinner fa-spin" style="font-size: 32px; color: var(--court-blue); margin-bottom: 15px;"></i>
                    <p style="color: var(--text-gray);">ì…ì°°ë‚´ì—­ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                </div>
                <div th:if="${payments != null and payments.isEmpty()}" class="no-payments">
                    <div class="no-payments-icon">ğŸ“‹</div>
                    <h3>ì…ì°°ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤</h3>
                    <p>ì•„ì§ ì…ì°°ì„œë¥¼ ì‘ì„±í•œ ë¬¼ê±´ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                    <a th:href="@{/auctionList}" style="padding: 12px 24px; background: var(--court-blue); color: #fff; text-decoration: none; border-radius: 0; font-size: 16px; font-weight: 700; display: inline-block;">ê²½ë§¤ ë‘˜ëŸ¬ë³´ê¸°</a>
                </div>
                <table class="auction-table" th:if="${payments != null and !payments.isEmpty()}">
                    <thead>
                        <tr>
                            <th style="width: 5%;">ë¬¼ê±´<br>ë²ˆí˜¸</th>
                            <th style="width: 35%;">ì†Œì¬ì§€ ë° ë‚´ì—­</th>
                            <th style="width: 10%;">ë¹„ê³ </th>
                            <th style="width: 15%;">ê°ì •í‰ê°€ì•¡<br>ìµœì €ë§¤ê°ê°€ê²©</th>
                            <th style="width: 10%;">ì…ì°°ì •ë³´</th>
                            <th style="width: 10%;">ë³´ì¦ê¸ˆ<br>ìƒíƒœ</th>
                            <th style="width: 8%;">ê²°ì œ</th>
                            <th style="width: 7%;">ì‚­ì œ</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="payment, stat : ${payments}" 
                            th:attr="onclick='goToBidDetail(' + ${payment.id} + ')'" 
                            style="cursor: pointer;">
                            <td class="item-number" th:text="${payments.size() - stat.index}">1</td>
                            <td>
                                <div class="location-details">
                                    <div style="display: flex; gap: 8px; align-items: center; margin-bottom: 5px;">
                                        <span class="usage-badge">ì˜¨ë¹„ë“œ</span>
                                        <span class="case-number" th:text="'ë¬¼ê±´ë²ˆí˜¸: ' + (${payment.cltrNo != null and payment.cltrNo != '' ? payment.cltrNo : '-'})">ë¬¼ê±´ë²ˆí˜¸: -</span>
                                    </div>
                                    <div class="address" th:text="${payment.itemName != null and payment.itemName != '' ? payment.itemName : 'ë¬¼ê±´ ì •ë³´ ì—†ìŒ'}">ì£¼ì†Œ</div>
                                </div>
                            </td>
                            <td class="remarks">
                                <div>â€¢ ê³µê³µê²½ë§¤</div>
                            </td>
                            <td class="price-info">
                                <div class="price-label">ì…ì°°ê¸ˆì•¡</div>
                                <div class="price-value min-price" th:text="${payment.amount != null ? (#numbers.formatInteger(payment.amount, 3, 'COMMA') + 'ì›') : '-'}">-</div>
                            </td>
                            <td class="dept-info">
                                <div class="bid-submit-date" th:text="'ì…ì°°ì„œì œì¶œì¼: ' + ${payment.formattedCreatedDate != null ? payment.formattedCreatedDate : '-'}">ì…ì°°ì„œì œì¶œì¼: -</div>
                                <div class="bid-deadline" th:text="'ì…ì°°ë§ˆê°ì¼ì‹œ: ' + ${payment.formattedDeadlineDate != null ? payment.formattedDeadlineDate : '-'}">ì…ì°°ë§ˆê°ì¼ì‹œ: -</div>
                            </td>
                            <td class="dept-info">
                                <span th:class="${payment.status == 'paid' ? 'status-badge-table paid' : 'status-badge-table unpaid'}"
                                      th:text="${payment.status == 'paid' ? 'ì™„ë‚©' : 'ë¯¸ë‚©'}">ë¯¸ë‚©</span>
                            </td>
                            <td class="payment-action" onclick="event.stopPropagation();">
                                <!-- ë¯¸ë‚©ì¼ ê²½ìš°ì—ë§Œ ê²°ì œ ë²„íŠ¼ í‘œì‹œ -->
                                <button th:if="${payment.status != 'paid'}" 
                                        class="btn-payment"
                                        th:attr="data-payment-id=${payment.id},
                                                 data-auction-no=${payment.auctionNo != null ? payment.auctionNo : ''},
                                                 data-item-id=${payment.itemId != null ? payment.itemId : ''},
                                                 data-cltr-no=${payment.cltrNo != null ? payment.cltrNo : ''}"
                                        onclick="handlePaymentClick(event, this)">
                                    ê²°ì œ
                                </button>
                                <!-- ì™„ë‚©ì¼ ê²½ìš° ì™„ë£Œ í‘œì‹œ -->
                                <span th:if="${payment.status == 'paid'}" 
                                      style="color: #28a745; font-weight: 600; font-size: 13px;">
                                    ê²°ì œì™„ë£Œ
                                </span>
                            </td>
                            <td style="text-align: center;" onclick="event.stopPropagation();">
                                <button class="btn-delete" 
                                        th:attr="onclick='event.stopPropagation(); deletePayment(' + ${payment.id} + ')'"
                                        title="ì…ì°°ë‚´ì—­ ì‚­ì œ">
                                    <i class="fas fa-trash-alt"></i>
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </section>
</main>

<!-- =================== í‘¸í„° =================== -->
<div th:replace="~{layout/footer :: footer}"></div>

<script>
    function goToBidDetail(paymentId) {
        if (paymentId) {
            window.location.href = '/payment/detail/' + paymentId;
        }
    }
    
    /**
     * ê²°ì œ ë²„íŠ¼ í´ë¦­ í•¸ë“¤ëŸ¬
     * ì´ë²¤íŠ¸ ì „íŒŒë¥¼ ë§‰ê³  ê²°ì œ í˜ì´ì§€ë¡œ ì´ë™
     */
    function handlePaymentClick(event, button) {
        // ì´ë²¤íŠ¸ ì „íŒŒ ì¤‘ì§€ (í–‰ í´ë¦­ ì´ë²¤íŠ¸ ë°©ì§€)
        if (event) {
            event.stopPropagation();
            event.preventDefault();
        }
        
        console.log('ê²°ì œ ë²„íŠ¼ í´ë¦­ë¨');
        
        // ë²„íŠ¼ì˜ data ì†ì„±ì—ì„œ ê°’ ê°€ì ¸ì˜¤ê¸°
        const paymentId = button.getAttribute('data-payment-id');
        const auctionNo = button.getAttribute('data-auction-no');
        const itemId = button.getAttribute('data-item-id');
        const cltrNo = button.getAttribute('data-cltr-no');
        
        console.log('ê²°ì œ ì •ë³´:', {
            paymentId: paymentId,
            auctionNo: auctionNo,
            itemId: itemId,
            cltrNo: cltrNo
        });
        
        // ê²°ì œ í˜ì´ì§€ URL êµ¬ì„±
        let paymentUrl = '/payment/checkout?';
        let hasParam = false;
        
        if (auctionNo && auctionNo !== '' && auctionNo !== 'null') {
            paymentUrl += 'auctionNo=' + auctionNo;
            hasParam = true;
        } else if (itemId && itemId !== '' && itemId !== 'null') {
            paymentUrl += 'itemId=' + itemId;
            hasParam = true;
        } else if (cltrNo && cltrNo !== '' && cltrNo !== 'null') {
            paymentUrl += 'cltrNo=' + encodeURIComponent(cltrNo);
            hasParam = true;
        }
        
        if (!hasParam) {
            alert('ë¬¼ê±´ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•´ì£¼ì„¸ìš”.');
            console.error('ë¬¼ê±´ ì‹ë³„ì ì—†ìŒ:', { auctionNo, itemId, cltrNo });
            return;
        }
        
        console.log('ê²°ì œ í˜ì´ì§€ë¡œ ì´ë™:', paymentUrl);
        window.location.href = paymentUrl;
    }
    
    /**
     * ì…ì°°ë‚´ì—­ ì‚­ì œ
     */
    function deletePayment(paymentId) {
        console.log('=== ì‚­ì œ í•¨ìˆ˜ í˜¸ì¶œ ===');
        console.log('paymentId:', paymentId, 'íƒ€ì…:', typeof paymentId);
        
        if (!paymentId) {
            alert('ì…ì°°ë‚´ì—­ IDê°€ ì—†ìŠµë‹ˆë‹¤.');
            console.error('paymentIdê°€ ì—†ìŠµë‹ˆë‹¤!');
            return;
        }
        
        if (!confirm('ì…ì°°ë‚´ì—­ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì‚­ì œëœ ë‚´ì—­ì€ ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
            return;
        }
        
        const deleteUrl = '/payment/delete/' + paymentId;
        console.log('ì‚­ì œ URL:', deleteUrl);
        
        // ë¨¼ì € POSTë¡œ ì‹œë„ (ë” ì•ˆì •ì )
        $.ajax({
            url: deleteUrl,
            method: 'POST',
            dataType: 'json',
            beforeSend: function() {
                console.log('POST ì‚­ì œ ìš”ì²­ ì „ì†¡ ì¤‘...');
            },
            success: function(response) {
                console.log('ì‚­ì œ ì‘ë‹µ ë°›ìŒ:', response);
                if (response && response.success) {
                    alert('ì…ì°°ë‚´ì—­ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                    // í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
                    location.reload();
                } else {
                    const errorMsg = response ? (response.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜') : 'ì‘ë‹µì´ ì—†ìŠµë‹ˆë‹¤.';
                    alert('ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + errorMsg);
                    console.error('ì‚­ì œ ì‹¤íŒ¨:', response);
                }
            },
            error: function(xhr, status, error) {
                console.error('POST ì‚­ì œ ì˜¤ë¥˜:', { 
                    status: status, 
                    error: error, 
                    statusCode: xhr.status,
                    responseText: xhr.responseText,
                    url: deleteUrl
                });
                
                // POSTê°€ ì‹¤íŒ¨í•˜ë©´ DELETEë¡œ ì¬ì‹œë„
                if (xhr.status === 404 || xhr.status === 405) {
                    console.log('DELETE ë©”ì„œë“œë¡œ ì¬ì‹œë„...');
                    $.ajax({
                        url: deleteUrl,
                        method: 'DELETE',
                        dataType: 'json',
                        success: function(response) {
                            console.log('DELETE ì‚­ì œ ì‘ë‹µ ë°›ìŒ:', response);
                            if (response && response.success) {
                                alert('ì…ì°°ë‚´ì—­ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                                location.reload();
                            } else {
                                const errorMsg = response ? (response.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜') : 'ì‘ë‹µì´ ì—†ìŠµë‹ˆë‹¤.';
                                alert('ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + errorMsg);
                            }
                        },
                        error: function(xhr2, status2, error2) {
                            console.error('DELETEë„ ì‹¤íŒ¨:', { 
                                status: status2, 
                                error: error2, 
                                statusCode: xhr2.status,
                                responseText: xhr2.responseText 
                            });
                            let errorMsg = 'ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
                            
                            if (xhr2.status === 401 || xhr2.status === 403) {
                                errorMsg = 'ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.';
                            } else if (xhr2.status === 404) {
                                errorMsg = 'ì…ì°°ë‚´ì—­ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. (ê²½ë¡œ: ' + deleteUrl + ')';
                            } else if (xhr2.status === 500) {
                                errorMsg = 'ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
                            }
                            
                            alert(errorMsg + '\nìƒíƒœ ì½”ë“œ: ' + xhr2.status);
                        }
                    });
                    return;
                }
                
                let errorMsg = 'ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
                
                if (xhr.status === 401 || xhr.status === 403) {
                    errorMsg = 'ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.';
                } else if (xhr.status === 404) {
                    errorMsg = 'ì…ì°°ë‚´ì—­ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. (ê²½ë¡œ: ' + deleteUrl + ')';
                } else if (xhr.status === 500) {
                    errorMsg = 'ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
                }
                
                alert(errorMsg + '\nìƒíƒœ ì½”ë“œ: ' + xhr.status);
            }
        });
    }
    
    /**
     * ê¸°ì¡´ í•¨ìˆ˜ (í•˜ìœ„ í˜¸í™˜ì„± ìœ ì§€)
     */
    function goToPayment(paymentId, auctionNo, itemId, cltrNo) {
        console.log('goToPayment í˜¸ì¶œ:', { paymentId, auctionNo, itemId, cltrNo });
        
        let paymentUrl = '/payment/checkout?';
        let hasParam = false;
        
        if (auctionNo && auctionNo !== null && auctionNo !== 'null' && auctionNo !== '') {
            paymentUrl += 'auctionNo=' + auctionNo;
            hasParam = true;
        } else if (itemId && itemId !== null && itemId !== 'null' && itemId !== '') {
            paymentUrl += 'itemId=' + itemId;
            hasParam = true;
        } else if (cltrNo && cltrNo !== null && cltrNo !== 'null' && cltrNo !== '') {
            paymentUrl += 'cltrNo=' + encodeURIComponent(cltrNo);
            hasParam = true;
        }
        
        if (!hasParam) {
            alert('ë¬¼ê±´ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            return;
        }
        
        window.location.href = paymentUrl;
    }
</script>

</body>
</html>
